#!/usr/bin/env bash

fa_thermometer_0='\U000f2cb'
fa_thermometer_quarter='\U000f2ca'
fa_thermometer_3='\U000f2c8'
fa_thermometer_half='\U000f2c9'
fa_thermometer_full='\U000f2c7'

CHIP="coretemp-isa-0000"

fa_area_chart='\U000f1fe'

fa_wifi='\U000f1eb'
fa_arrow_circle_o_down='\U000f01a'
fa_arrow_circle_o_up='\U000f01b'

fa_database='\U000f1c0'

fa_tasks='\U000f0ae'

fa_battery_full='\U000f240'
fa_batterry_three_quarters='\U000f241'
fa_batterry_half='\U000f242'
fa_batterry_quarter='\U000f243'
fa_batterry_empty='\U000f244'

fa_terminal='\U000f120'

fa_microship='\U000f2db'

# Get average user usage of cpu
cpu() {
	echo "$(awk '/^cpu MHz/ {sum+=$4; count++} END{OFMT="%.2f"; print sum/count}' /proc/cpuinfo)MHz"
}

temperature() {
	local mean_t=0

	mean_t=`sensors -u $CHIP |\
	awk '
		BEGIN {
			count=0
		}

		/temp[0-9]+_input:/ {
			temps+=$2
			count++
		}

		END {
			printf("%.2f\n", temps/count)
	   }
'`
	echo $mean_t
}

mean_t=$(temperature)
if [[ $mean_t < 50.00 ]]; then
	color="blue"
	cpu_usage_color='#53ff1a'
	icon="$fa_thermometer_0"
elif [[ $mean_t < 60.00 ]]; then
	color="yellow"
	cpu_usage_color="yellow"
	icon="$fa_thermometer_3"
else
	color="red"
	cpu_usage_color="red"
	icon="$fa_thermometer_full"
fi

echo -e "<span foreground='red' font_desc='EmojiSymbols'>$fa_microship</span>"\
	 "<span foreground='$cpu_usage_color'>$(cpu)</span>"\
	 "<span foreground='$color' font_desc='EmojiSymbols'>$icon $mean_tÂ°C</span>"
